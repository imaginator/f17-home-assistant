---
# F: Script pour piloter l'aspirateur et reconstruir la carte
# E: Script to pilot the Xioami Vacuum when the map is reseted.
#
# F: Ce script va diriger le robot Ã  plusieurs endroits de la maison
#    pour recontruire la carte.
#
# E: This script will make the robot go in all house to reconstruct
#    the map.
#
# https://www.home-assistant.io/components/vacuum/
# https://www.home-assistant.io/components/vacuum.xiaomi_miio/
# https://www.home-assistant.io//getting-started/scripts/
#
alias: "build imagisuck's map"
description: "Rebuild Apartment Map"
mode: single
sequence:
  # first put the fan_speed at minimum to avoid noise
  - service: vacuum.set_fan_speed
    data:
      entity_id: vacuum.rockrobo_vacuum_v1
      fan_speed: Silent

  # launch a standard clean during 10 secondes to create the first part of the map
  - service: vacuum.start
    data:
      entity_id: vacuum.rockrobo_vacuum_v1
  - delay:
      seconds: 20

  - service: vacuum.stop
    data:
      entity_id: vacuum.rockrobo_vacuum_v1
  - wait_for_trigger:
      - platform: state
        entity_id: vacuum.rockrobo_vacuum_v1
        to: "idle"
  #
  # send goto_target commands to pilot the robot through the house
  #

  # End of small hallway/startmain hallway
  - service: vacuum.send_command
    data:
      entity_id: vacuum.rockrobo_vacuum_v1
      command: app_goto_target
      params: [24082, 31477]
  - wait_for_trigger:
      - platform: state
        entity_id: vacuum.rockrobo_vacuum_v1
        to: "idle"

# Near Fireplace
  - service: vacuum.send_command
    data:
      entity_id: vacuum.rockrobo_vacuum_v1
      command: app_goto_target
      params: [36900, 31477]
  - wait_for_trigger:
      - platform: state
        entity_id: vacuum.rockrobo_vacuum_v1
        to: "idle"

# Go back to the dock
  - service: vacuum.return_to_base
    data:
      entity_id: vacuum.rockrobo_vacuum_v1
  - wait_for_trigger:
      - platform: state
        entity_id: vacuum.rockrobo_vacuum_v1
        to: "idle"
